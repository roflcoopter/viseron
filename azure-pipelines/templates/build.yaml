parameters:
  - name: architecture
    type: string
  - name: image
    type: string

steps:
  - script: docker run --rm --privileged multiarch/qemu-user-static:register --reset
    displayName: Register QEMU for cross-builds
  - script: |
      cd $(Agent.BuildDirectory)/s/docker
      echo Building FFmpeg for ${{ parameters.architecture }}
      docker-compose --file ../azure-pipelines/docker-compose-build.yaml --env-file ../azure-pipelines/.env build ${{ parameters.architecture }}-${{ parameters.image }}
      done
    displayName: Build FFmpeg
